{"version":3,"file":"default-src_app_pages_create-user_create-user_page_ts.js","mappings":"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","sources":["./src/app/pages/create-user/create-user.page.ts","./src/app/pages/create-user/create-user.page.html"],"sourcesContent":["import { Component, Input, OnInit, Renderer2, ViewChild } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { IonInput, ModalController } from '@ionic/angular';\r\nimport * as L from 'leaflet';\r\nimport { Usuario } from 'src/app/model/Usuario';\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { LoadingService } from 'src/app/services/loading.service';\r\nimport { ToastService } from 'src/app/services/toast.service';\r\nimport { UsuariosService } from 'src/app/services/usuarios.service';\r\n\r\n@Component({\r\n  selector: 'app-create-user',\r\n  templateUrl: './create-user.page.html',\r\n  styleUrls: ['./create-user.page.scss'],\r\n})\r\nexport class CreateUserPage implements OnInit {\r\n  @ViewChild('password') password: IonInput;\r\n  isOpen: boolean = false;\r\n  map: any;\r\n  public formUsuario: FormGroup;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    private renderer: Renderer2,\r\n    private fb: FormBuilder,\r\n    private toast: ToastService,\r\n    private usuarioService: UsuariosService,\r\n    private authService: AuthService,\r\n    private miLoading: LoadingService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.formUsuario = this.fb.group({\r\n      nombre_comercio: ['', [Validators.required, Validators.minLength(2)]],\r\n      password: ['', [Validators.required, Validators.minLength(2)]],\r\n      email: ['', [Validators.required, Validators.minLength(2)]],\r\n      direccion: ['', [Validators.required, Validators.minLength(2)]],\r\n      latitud: ['', [Validators.required, Validators.minLength(2)]],\r\n      longitud: ['', [Validators.required, Validators.minLength(2)]],\r\n      telefono: ['', [Validators.required, Validators.minLength(2)]],\r\n      administrador: ['false', [Validators.required, Validators.minLength(2)]],\r\n    });\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    this.initMap();\r\n  }\r\n\r\n  initMap() {\r\n    this.map = L.map('map').setView([37.66994, -4.72531], 13);\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n      maxZoom: 19,\r\n      attribution:\r\n        '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    }).addTo(this.map);\r\n    setTimeout(() => {\r\n      this.map.invalidateSize();\r\n    }, 200);\r\n    let marker = L.marker([37.66994, -4.72531], {\r\n      draggable: true,\r\n    }).addTo(this.map);\r\n    marker.on('dragend', () => {\r\n      this.formUsuario.get('latitud').setValue(marker.getLatLng().lat);\r\n      this.formUsuario.get('longitud').setValue(marker.getLatLng().lng);\r\n    });\r\n  }\r\n\r\n  public async saveUsuario() {\r\n    if (this.validateEmail(this.formUsuario.get('email').value)) {\r\n      if (this.validatePassword(this.formUsuario.get('password').value)) {\r\n        this.miLoading.showLoading();\r\n        let uid = await this.authService.SignUp(\r\n          this.formUsuario.get('email').value,\r\n          this.formUsuario.get('password').value\r\n        );\r\n        let usuario: Usuario = {\r\n          id: -1,\r\n          admin: false,\r\n          direccion: this.formUsuario.get('direccion').value,\r\n          email: this.formUsuario.get('email').value,\r\n          latitud: this.formUsuario.get('latitud').value,\r\n          longitud: this.formUsuario.get('longitud').value,\r\n          nombre_comercio: this.formUsuario.get('nombre_comercio').value,\r\n          participaciones: 0,\r\n          telefono: this.formUsuario.get('telefono').value,\r\n          uid: uid,\r\n        };\r\n        //guardar en firebase para obtener el uid\r\n        await this.usuarioService.postUsuario(usuario);\r\n        this.miLoading.hideLoading();\r\n        this.toast.showToast('Usuario creado con éxito', 'tertiary');\r\n        this.cerrar();\r\n      } else {\r\n        //mal contraseña\r\n        this.toast.showToast(\r\n          'Has introducido una contraseña demasiado corta',\r\n          'warning'\r\n        );\r\n      }\r\n    } else {\r\n      this.toast.showToast('Has introducido un email inválido', 'warning');\r\n    }\r\n  }\r\n\r\n  public cerrar() {\r\n    this.modalController.dismiss();\r\n  }\r\n\r\n  public clickMapButton() {\r\n    this.isOpen = this.isOpen ? false : true;\r\n    if (this.isOpen) {\r\n      this.show();\r\n    } else {\r\n      this.hide();\r\n    }\r\n    console.log(this.isOpen);\r\n  }\r\n\r\n  show() {\r\n    const parent: HTMLElement = document.getElementById('map');\r\n    this.renderer.setStyle(parent, 'display', 'block');\r\n    setTimeout(() => {\r\n      this.map.invalidateSize(true);\r\n    }, 200);\r\n  }\r\n\r\n  hide() {\r\n    const parent: HTMLElement = document.getElementById('map');\r\n    this.renderer.setStyle(parent, 'display', 'none');\r\n    setTimeout(() => {\r\n      this.map.invalidateSize(true);\r\n    }, 200);\r\n  }\r\n\r\n  public mostrarContrasena() {\r\n    if (this.password.type == 'password') {\r\n      this.password.type = 'text';\r\n    } else {\r\n      this.password.type = 'password';\r\n    }\r\n  }\r\n\r\n  public get isPassword(): boolean {\r\n    return this.password.type == 'password';\r\n  }\r\n\r\n  public validateEmail(email: string): boolean {\r\n    let regexp = new RegExp(\r\n      /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\r\n    );\r\n    return regexp.test(email);\r\n  }\r\n\r\n  public validatePassword(pass: string): boolean {\r\n    let validate: boolean = pass.length > 5 ? true : false;\r\n    return validate;\r\n  }\r\n}\r\n","export default \"<ion-header>\\r\\n  <ion-toolbar color=\\\"warning\\\" class=\\\"header\\\">\\r\\n    <ion-title>CREAR USUARIO</ion-title>\\r\\n    <ion-buttons slot=\\\"end\\\">\\r\\n      <ion-icon class=\\\"close-btn\\\" name=\\\"close-circle\\\" (click)=\\\"cerrar()\\\"></ion-icon>\\r\\n    </ion-buttons>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n\\r\\n  <div class=\\\"home\\\">\\r\\n    <form [formGroup]=\\\"formUsuario\\\" (ngSubmit)=\\\"saveUsuario()\\\" novalidate>\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"input\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Nombre del Comercio</ion-label>\\r\\n        <ion-input formControlName=\\\"nombre_comercio\\\" type=\\\"text\\\" required></ion-input>\\r\\n      </ion-item>\\r\\n\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"input\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Contraseña</ion-label>\\r\\n        <ion-input #password formControlName=\\\"password\\\" type=\\\"password\\\" required></ion-input>\\r\\n        <ion-button size=\\\"small\\\" slot=\\\"end\\\" color=\\\"tertiary\\\" type=\\\"button\\\" (click)=\\\"mostrarContrasena()\\\"><ion-icon name=\\\"eye-off-outline\\\"></ion-icon></ion-button>\\r\\n      </ion-item>\\r\\n\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"input\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Correo Electrónico</ion-label>\\r\\n        <ion-input formControlName=\\\"email\\\" type=\\\"text\\\" required></ion-input>\\r\\n      </ion-item>\\r\\n\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"input\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Telefono</ion-label>\\r\\n        <ion-input formControlName=\\\"telefono\\\" type=\\\"number\\\" required></ion-input>\\r\\n      </ion-item>\\r\\n\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"input\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Dirección</ion-label>\\r\\n        <ion-input formControlName=\\\"direccion\\\" type=\\\"text\\\" required></ion-input>\\r\\n      </ion-item>\\r\\n      <ion-item lines=\\\"full\\\" class=\\\"no-click\\\">\\r\\n        <ion-label position=\\\"floating\\\" class=\\\"label\\\">Latitud y Longitud</ion-label>\\r\\n        <ion-input formControlName=\\\"latitud\\\" type=\\\"number\\\" required></ion-input>\\r\\n        <ion-input formControlName=\\\"longitud\\\" type=\\\"number\\\" required></ion-input>\\r\\n      </ion-item>\\r\\n      <br>\\r\\n      <ion-button type=\\\"button\\\" (click)=\\\"clickMapButton()\\\" color=\\\"tertiary\\\" expand=\\\"block\\\">ABRIR MAPA</ion-button>\\r\\n      <div class=\\\"map\\\" id=\\\"map\\\"></div>\\r\\n      <ion-row>\\r\\n        <ion-col>\\r\\n          <ion-button type=\\\"submit\\\" color=\\\"tertiary\\\" expand=\\\"block\\\">CREAR</ion-button>\\r\\n        </ion-col>\\r\\n      </ion-row>\\r\\n    </form>\\r\\n  </div>\\r\\n\\r\\n</ion-content>\\r\\n\";"],"names":[],"sourceRoot":"webpack:///"}