{"version":3,"file":"src_app_pages_crear-participaciones_crear-participaciones_module_ts.js","mappings":"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","sources":["./src/app/pages/crear-participaciones/crear-participaciones-routing.module.ts","./src/app/pages/crear-participaciones/crear-participaciones.module.ts","./src/app/pages/crear-participaciones/crear-participaciones.page.ts","./src/app/pages/crear-participaciones/crear-participaciones.page.html"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { CrearParticipacionesPage } from './crear-participaciones.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: CrearParticipacionesPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class CrearParticipacionesPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { CrearParticipacionesPageRoutingModule } from './crear-participaciones-routing.module';\r\n\r\nimport { CrearParticipacionesPage } from './crear-participaciones.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    CrearParticipacionesPageRoutingModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [CrearParticipacionesPage]\r\n})\r\nexport class CrearParticipacionesPageModule {}\r\n","import { Component, Input, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { Boleto } from 'src/app/model/Boleto';\r\nimport { Usuario } from 'src/app/model/Usuario';\r\nimport { LoadingService } from 'src/app/services/loading.service';\r\nimport { ToastService } from 'src/app/services/toast.service';\r\nimport { UsuariosService } from 'src/app/services/usuarios.service';\r\n\r\n@Component({\r\n  selector: 'app-crear-participaciones',\r\n  templateUrl: './crear-participaciones.page.html',\r\n  styleUrls: ['./crear-participaciones.page.scss'],\r\n})\r\nexport class CrearParticipacionesPage implements OnInit {\r\n  @Input() nBoletos: number;\r\n  @Input() allboletos: Boleto[];\r\n\r\n  public usuarios: Usuario[] = [];\r\n  public usuario: Usuario;\r\n  private isDisabled: boolean = false;\r\n  public _NParticipaciones: number;\r\n  public number:number = 0;\r\n\r\n  public boletos: Boleto[] = [];\r\n  public formParticipaciones: FormGroup;\r\n\r\n  constructor(\r\n    private modalController: ModalController,\r\n    public api: UsuariosService,\r\n    private fb: FormBuilder,\r\n    public toast: ToastService,\r\n    private loading: LoadingService\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.modalController.dismiss(); //Cierra el modal anterior\r\n    this.formParticipaciones = this.fb.group({\r\n      participacion: ['',Validators.max(this.nBoletos)],\r\n    });\r\n    this._NParticipaciones = this.nBoletos;\r\n  }\r\n\r\n  async ionViewDidEnter() {\r\n    this.loading.showLoading();\r\n    await this.getAllUsuarios();\r\n    this.loading.hideLoading();\r\n  }\r\n\r\n  async validador() {\r\n    let result: boolean = false;\r\n    if (this.nBoletos === 0) {\r\n      result = true;\r\n      await this.setParticipaciones();\r\n      this.toast.showToast('Participaciones actualizadas', 'tertiary');\r\n      this.cerrar();\r\n    } else {\r\n      result = false;\r\n      this.toast.showToast(\r\n        'Asegúrese de repartir '+this._NParticipaciones+' de participaciones.',\r\n        'danger'\r\n      );\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Método para setear el número de participaciones que le corresponde a cada comercio\r\n   */\r\n  public async setParticipaciones() {\r\n    this.loading.showLoading();\r\n    this.usuarios = await this.api.getUsuarios();\r\n    for (let i = 0; i < this.usuarios.length; i++) {\r\n      if (\r\n        this.allboletos[0].usuario.nombre_comercio ==\r\n        this.usuarios[i].nombre_comercio\r\n      ) {\r\n      } else {\r\n        let participacion: number =\r\n          this.formParticipaciones.get('participacion').value;\r\n        let updateUsuario: Usuario = this.usuarios[i];\r\n        updateUsuario.participaciones =\r\n          updateUsuario.participaciones + participacion;\r\n        this.usuario = await this.api.putUsuario(updateUsuario);\r\n      }\r\n    }\r\n    this.loading.hideLoading();\r\n  }\r\n\r\n\r\n  /**\r\n   * Cierra el modal\r\n   */\r\n  public cerrar() {\r\n    this.modalController.dismiss();\r\n  }\r\n\r\n  public async getAllUsuarios(): Promise<Usuario[]> {\r\n    try {\r\n      this.usuarios = await this.api.getUsuarios();\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n    return this.usuarios;\r\n  }\r\n}\r\n","export default \"<ion-header>\\r\\n  <ion-toolbar color=\\\"warning\\\" class=\\\"header\\\">\\r\\n    <ion-title>Reparto de participaciones</ion-title>\\r\\n    <ion-buttons slot=\\\"end\\\">\\r\\n      <ion-icon\\r\\n        name=\\\"close-circle\\\"\\r\\n        class=\\\"close-btn\\\"\\r\\n        (click)=\\\"cerrar()\\\"\\r\\n      ></ion-icon>\\r\\n    </ion-buttons>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n<ion-content>\\r\\n  \\r\\n  <form [formGroup]=\\\"formParticipaciones\\\" (ngSubmit)=\\\"validador()\\\">\\r\\n    <ion-label class=\\\"label\\\">Tiene {{nBoletos}} a repartir: </ion-label>\\r\\n    <div class=\\\"home\\\" *ngFor=\\\"let usuario of usuarios; let i=index\\\">\\r\\n   \\r\\n      <ion-label\\r\\n        *ngIf=\\\"this.allboletos[0].usuario.nombre_comercio!=usuario.nombre_comercio\\\"\\r\\n        >{{usuario.nombre_comercio}}\\r\\n      </ion-label>\\r\\n      <ion-item\\r\\n        class=\\\"input\\\"\\r\\n        *ngIf=\\\"this.allboletos[0].usuario.nombre_comercio!=usuario.nombre_comercio\\\"\\r\\n      >\\r\\n        <ion-input\\r\\n          type=\\\"number\\\"\\r\\n          min=\\\"0\\\"\\r\\n          formControlName=\\\"participacion\\\"\\r\\n          placeholder=\\\"Enter nº de parcipaciones...\\\"\\r\\n        ></ion-input>\\r\\n      </ion-item>\\r\\n\\r\\n  \\r\\n    </div>\\r\\n    <ion-label>*Asegúrese que el nº de participaciones no supera al nº de boletos disponibles</ion-label>\\r\\n    <ion-button \\r\\n      class=\\\"button\\\"\\r\\n      expand=\\\"full\\\"\\r\\n      [disabled]=\\\"this.formParticipaciones.invalid\\\"\\r\\n      color=\\\"tertiary\\\"\\r\\n      type=\\\"submit\\\"\\r\\n      (ngSubmit)=\\\"validador()\\\"\\r\\n      >Confirmar</ion-button\\r\\n    >\\r\\n    \\r\\n  </form>\\r\\n</ion-content>\\r\\n\";"],"names":[],"sourceRoot":"webpack:///"}